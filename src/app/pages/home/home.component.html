<!-- Page d'accueil Dentis - Style Doctolib -->
<app-dashboard-header *ngIf="isPatientConnected || isDentistConnected; else publicHeader"></app-dashboard-header>
<ng-template #publicHeader>
    <app-header></app-header>
</ng-template>

<main class="main">
  <!-- Section Hero -->
  <section class="hero">
    <div class="hero-content">
      <div class="hero-text">
        <h2 class="hero-title">Votre sourire,<span class="hero-title-accent"> notre priorité</span></h2>
        
        <!-- Barre de recherche -->
        <div class="search-container" *ngIf="!isDentistConnected">
          <div class="search-bar">
            <div class="search-input-group">
              <div class="search-field">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle cx="11" cy="11" r="8" stroke="#999" stroke-width="2"/>
                  <path d="m21 21-4.35-4.35" stroke="#999" stroke-width="2"/>
                </svg>
                <input 
                  type="text" 
                  placeholder="Nom, ville, établissement,..."
                  class="search-input search-what"
                  [(ngModel)]="searchTerm"
                  (input)="onSearchInput()"
                  (focus)="onFocus()"
                  (blur)="onBlur()"
                >
                
                <!-- DROPDOWN RESULTS MIXED -->
                <div class="search-dropdown" *ngIf="showDropdown && (dropdownServices.length > 0 || dropdownDentists.length > 0)">
                    
                    <!-- Services Section -->
                    <div *ngIf="dropdownServices.length > 0">
                        <!-- <div class="dropdown-section-title" *ngIf="dropdownDentists.length > 0">Actes et soins</div> -->
                        <div class="dropdown-item service-item" *ngFor="let service of dropdownServices" (click)="selectService(service)">
                             <div class="service-icon-container">
                                 <svg class="service-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                 </svg>
                             </div>
                             <span class="service-text">{{ service }}</span>
                        </div>
                    </div>

                    <div class="dropdown-divider" *ngIf="dropdownServices.length > 0 && dropdownDentists.length > 0"></div>

                    <!-- Dentists Section -->
                     <div *ngIf="dropdownDentists.length > 0">
                        <!-- <div class="dropdown-section-title" *ngIf="dropdownServices.length > 0">Chirurgiens-dentistes</div> -->
                        <div class="dropdown-item dentist-item" *ngFor="let dentist of dropdownDentists" (click)="selectDentist(dentist)">
                            <div class="item-avatar">
                                 <img [src]="dentist.photo || defaultAvatar" alt="Dr. {{ dentist.nom }}">
                            </div>
                            <div class="item-info">
                                <span class="item-name">Dr. {{ dentist.prenom }} <span class="highlight">{{ dentist.nom }}</span></span>
                                <span class="item-details">{{ dentist.specialite || 'Chirurgien-dentiste' }} - {{ dentist.ville }}</span>
                            </div>
                        </div>
                     </div>
                </div>

                <!-- NO RESULTS -->
                 <div class="search-dropdown" *ngIf="showDropdown && dropdownServices.length === 0 && dropdownDentists.length === 0 && searchTerm.length > 1">
                    <div class="dropdown-item no-result">
                        Aucun résultat trouvé.
                    </div>
                 </div>

              </div>
              <div class="search-divider"></div>
              <div class="search-field">
                <svg class="location-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="#999" stroke-width="2"/>
                  <circle cx="12" cy="10" r="3" stroke="#999" stroke-width="2"/>
                </svg>
                <select 
                  class="search-input search-where"
                  [(ngModel)]="searchLocation"
                  style="cursor: pointer; appearance: none; -webkit-appearance: none; background: transparent;"
                >
                  <option value="" disabled selected>Où ?</option>
                  <option *ngFor="let gov of gouvernorats" [value]="gov">{{ gov }}</option>
                </select>
              </div>
            </div>
            <button class="search-btn" (click)="onSearch()">
              Rechercher
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
      <div class="hero-image">
        <img src="dentalteeth1.png" alt="Dental teeth" class="dental-image">
      </div>
    </div>
  </section>

  <!-- SEARCH RESULTS SECTION -->
  <section class="search-results-section" *ngIf="searchResults && searchResults.length > 0">
    <div class="results-container">
      <h2 class="section-title">Résultats de recherche</h2>
      <div class="results-grid">
        <div class="dentist-card" *ngFor="let dentist of searchResults">
          <div class="card-header">
            <div class="dentist-photo">
               <ng-container *ngIf="dentist.photo; else initialsBlock">
                   <img [src]="dentist.photo" alt="Dr. {{dentist.nom}}">
               </ng-container>
               <ng-template #initialsBlock>
                   <div class="avatar-circle">
                       {{ getInitials(dentist) }}
                   </div>
               </ng-template>
            </div>
            <div class="dentist-info">
              <h3 class="dentist-name">Dr. {{ dentist.prenom }} {{ dentist.nom }}</h3>
              <p class="dentist-speciality">{{ dentist.specialite || 'Chirurgien-dentiste' }}</p>
              <p class="dentist-address" *ngIf="dentist.adresse">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                   <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                   <circle cx="12" cy="10" r="3"></circle>
                </svg>
                {{ dentist.adresse }}
              </p>
             <p class="dentist-location" *ngIf="dentist.ville || dentist.gouvernorat">
                {{ dentist.ville }} <span *ngIf="dentist.ville && dentist.gouvernorat">,</span> {{ dentist.gouvernorat }}
             </p>
            </div>
          </div>
          <div class="card-footer">
             <button class="btn-book" (click)="selectDentist(dentist)">Prendre rendez-vous</button>
          </div>
        </div>
      </div>
    </div>
  </section>

</main>