<div class="details-container" *ngIf="dentist">
  <h1 class="page-title">Mon profil</h1>

  <div class="content-wrapper">
    <!-- Left Card: Personal Info -->
    <div class="info-card">
      <div class="card-header">
        <div class="avatar-wrapper">
            <ng-container *ngIf="dentist.photo; else initialsBlock">
                <img [src]="dentist.photo" class="img-avatar" alt="Photo">
            </ng-container>
            <ng-template #initialsBlock>
                <div class="avatar-circle">
                    {{ initials }}
                </div>
            </ng-template>
            <label class="avatar-edit-btn" for="photoInput">
                <i class="fas fa-camera"></i>
            </label>
            <input type="file" id="photoInput" (change)="onPhotoSelected($event)" accept="image/*" hidden>
        </div>

        <button class="btn-edit" (click)="openProfileEdit()">
          <i class="fas fa-edit"></i> Modifier
        </button>
      </div>

      <div class="card-body">
        <h2 class="user-name">
          {{ dentist.prenom }} {{ dentist.nom }}
        </h2>

        <p class="role-label">{{ dentist.specialite || 'Chirurgien Dentiste' }}</p>
        
        <div class="user-details">
            <p><strong>Téléphone :</strong> {{ dentist.tel || 'Non renseigné' }}</p>
            <p><strong>Adresse :</strong> 
                <ng-container *ngIf="dentist.adresse">{{ dentist.adresse }}</ng-container>
                <ng-container *ngIf="dentist.delegation">, {{ dentist.delegation }}</ng-container>
                <ng-container *ngIf="dentist.gouvernorat">, {{ dentist.gouvernorat }}</ng-container>
            </p>
            
            <p><strong>Diplôme :</strong> 
                <span *ngIf="!dentist.diplome" class="text-muted">Non renseigné</span>
                <!-- Check if big string or clean text -->
                <ng-container *ngIf="dentist.diplome">
                    <span *ngIf="!isBase64(dentist.diplome)">{{ dentist.diplome }}</span>
                    <a *ngIf="isBase64(dentist.diplome)" (click)="downloadDiplome()" style="cursor: pointer; color: #0076bd; text-decoration: underline;">
                        <i class="fas fa-file-download"></i> Voir le document
                    </a>
                </ng-container>
            </p>
        </div>
      </div>
    </div>

    <!-- Right Card: Working Hours -->
    <div class="hours-card">
        <div class="card-header">
            <h3>Horaires de travail</h3>
            <button class="btn-edit" (click)="openHorairesEdit()" title="Modifier les horaires">
                <i class="fas fa-edit"></i> Modifier
            </button>
        </div>
        
        <div class="hours-grid">
            <div class="day-row" *ngFor="let h of horaires">
                <span class="day-name">{{ h.jourSemaine | lowercase }}</span>
                <span class="hours" [class.closed]="h.estFerme">
                    {{ getScheduleForDay(h.jourSemaine) }}
                </span>
            </div>
        </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal-overlay" *ngIf="showProfileEditModal" (click)="closeProfileEdit()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">Modifier mon profil</h2>
            <button class="close-btn" (click)="closeProfileEdit()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form (ngSubmit)="saveProfile()">
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="field-label">Nom *</label>
                        <input [(ngModel)]="editProfileData.nom" name="nom" required class="form-input" placeholder="Votre nom">
                    </div>
                    <div class="form-group">
                        <label class="field-label">Prénom *</label>
                        <input [(ngModel)]="editProfileData.prenom" name="prenom" required class="form-input" placeholder="Votre prénom">
                    </div>
                </div>
                <div class="form-group">
                    <label class="field-label">Téléphone</label>
                    <input [(ngModel)]="editProfileData.tel" name="tel" class="form-input" placeholder="Ex: 22 222 222">
                </div>
                <div class="form-group">
                    <label class="field-label">Adresse</label>
                    <input [(ngModel)]="editProfileData.adresse" name="adresse" class="form-input" placeholder="Votre adresse">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="field-label">Gouvernorat</label>
                        <div class="select-wrapper">
                            <select [(ngModel)]="editProfileData.gouvernorat" name="gouvernorat" (change)="onGouvernoratChange()" class="form-input">
                                <option value="" disabled>Sélectionner un gouvernorat</option>
                                <option *ngFor="let g of gouvernoratList" [value]="g">{{ g }}</option>
                            </select>
                            <i class="fas fa-caret-down select-icon"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="field-label">Délégation</label>
                        <div class="select-wrapper">
                            <select [(ngModel)]="editProfileData.delegation" name="delegation" [disabled]="!editProfileData.gouvernorat" class="form-input">
                                <option value="" disabled>Sélectionner une délégation</option>
                                <option *ngFor="let del of delegationsOptions" [value]="del">{{ del }}</option>
                            </select>
                            <i class="fas fa-caret-down select-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="field-label">Spécialité</label>
                        <input [(ngModel)]="editProfileData.specialite" name="specialite" class="form-input" placeholder="Ex: Chirurgien Dentiste">
                    </div>
                    <!-- Diplome file upload -->
                    <div class="form-group">
                        <label class="field-label">Diplôme</label>
                        <input type="file" (change)="onFileSelected($event)" accept=".pdf, image/*" class="form-input file-input">
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-cancel" (click)="closeProfileEdit()">Annuler</button>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Horaires Modal (Same as before) -->
<app-working-hours-edit-modal
    *ngIf="showHorairesEditModal"
    [schedule]="editHorairesData"
    (close)="closeHorairesEdit()"
    (save)="saveHoraires($event)">
</app-working-hours-edit-modal>
