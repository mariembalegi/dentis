<div class="details-container" *ngIf="dentist">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a routerLink="/dashboard" class="back-link">
      ← Mon compte
    </a>
  </div>

  <h1 class="page-title">Mon profil</h1>

  <div class="content-wrapper">
    <!-- Left Card: Personal Info -->
    <div class="info-card">
      <div class="card-header">
        <ng-container *ngIf="dentist.photo; else initialsBlock">
            <img [src]="dentist.photo" class="img-avatar" alt="Photo">
        </ng-container>
        <ng-template #initialsBlock>
            <div class="avatar-circle">
                {{ initials }}
            </div>
        </ng-template>

        <button class="btn-edit" (click)="openProfileEdit()">
          <i class="fas fa-edit"></i> Modifier
        </button>
      </div>

      <div class="card-body">
        <h2 class="user-name">
          {{ dentist.prenom }} {{ dentist.nom }}
        </h2>

        <p class="role-label">{{ dentist.specialite || 'Chirurgien Dentiste' }}</p>
        
        <div class="user-details">
            <p><strong>Téléphone :</strong> {{ dentist.tel || 'Non renseigné' }}</p>
            <p><strong>Adresse :</strong> 
                <ng-container *ngIf="dentist.adresse">{{ dentist.adresse }}</ng-container>
                <ng-container *ngIf="dentist.delegation">, {{ dentist.delegation }}</ng-container>
                <ng-container *ngIf="dentist.gouvernorat">, {{ dentist.gouvernorat }}</ng-container>
            </p>
            
            <p><strong>Diplôme :</strong> 
                <span *ngIf="!dentist.diplome" class="text-muted">Non renseigné</span>
                <!-- Check if big string or clean text -->
                <ng-container *ngIf="dentist.diplome">
                    <span *ngIf="!isBase64(dentist.diplome)">{{ dentist.diplome }}</span>
                    <a *ngIf="isBase64(dentist.diplome)" (click)="downloadDiplome()" style="cursor: pointer; color: #0076bd; text-decoration: underline;">
                        <i class="fas fa-file-download"></i> Voir le document
                    </a>
                </ng-container>
            </p>
        </div>
      </div>
    </div>

    <!-- Right Card: Working Hours -->
    <div class="hours-card">
        <div class="card-header">
            <h3>Horaires de travail</h3>
            <button class="btn-edit" (click)="openHorairesEdit()" title="Modifier les horaires">
                <i class="fas fa-edit"></i> Modifier
            </button>
        </div>
        
        <div class="hours-grid">
            <div class="day-row" *ngFor="let h of horaires">
                <span class="day-name">{{ h.jourSemaine | lowercase }}</span>
                <span class="hours" [class.closed]="h.estFerme">
                    {{ getScheduleForDay(h.jourSemaine) }}
                </span>
            </div>
        </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal-overlay" *ngIf="showProfileEditModal" (click)="closeProfileEdit()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Modifier mon profil</h2>
        <form (ngSubmit)="saveProfile()">
            <div class="form-group">
                <label>Nom</label>
                <input [(ngModel)]="editProfileData.nom" name="nom" required>
            </div>
            <div class="form-group">
                <label>Prénom</label>
                <input [(ngModel)]="editProfileData.prenom" name="prenom" required>
            </div>
             <div class="form-group">
                <label>Téléphone</label>
                <input [(ngModel)]="editProfileData.tel" name="tel">
            </div>
            <div class="form-group">
                <label>Adresse</label>
                <input [(ngModel)]="editProfileData.adresse" name="adresse">
            </div>
            <div class="form-group">
                <label>Gouvernorat</label>
                <select [(ngModel)]="editProfileData.gouvernorat" name="gouvernorat" (change)="onGouvernoratChange()">
                   <option value="" disabled>Sélectionner</option>
                   <option *ngFor="let g of gouvernoratList" [value]="g">{{ g }}</option>
                </select>
            </div>
            <div class="form-group">
                <label>Délégation</label>
                <select [(ngModel)]="editProfileData.delegation" name="delegation" [disabled]="!editProfileData.gouvernorat">
                  <option value="" disabled>Sélectionner</option>
                  <option *ngFor="let del of delegationsOptions" [value]="del">{{ del }}</option>
                </select>
            </div>
            <div class="form-group">
                <label>Spécialité</label>
                <input [(ngModel)]="editProfileData.specialite" name="specialite">
            </div>
            <!-- Diplome file upload and preview -->
            <div class="form-group">
                <label>Diplôme</label>
                <input type="file" (change)="onFileSelected($event)" accept=".pdf, image/*">
                <div *ngIf="editProfileData.diplome" class="diplome-preview" style="margin-top: 10px;">
                    <img *ngIf="editProfileData.diplome.startsWith('data:image')" [src]="editProfileData.diplome" alt="Diplôme" style="max-width: 100%; max-height: 200px; border: 1px solid #ccc; padding: 4px;">
                    <p *ngIf="!editProfileData.diplome.startsWith('data:image')" style="font-size: 0.9rem; color: #666;">Fichier chargé ({{ editProfileData.diplome.substring(0, 30) }}...)</p>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn-cancel" (click)="closeProfileEdit()">Annuler</button>
                <button type="submit" class="btn-save">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Horaires Modal (Same as before) -->
<app-working-hours-edit-modal
    *ngIf="showHorairesEditModal"
    [schedule]="editHorairesData"
    (close)="closeHorairesEdit()"
    (save)="saveHoraires($event)">
</app-working-hours-edit-modal>
